<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="ulohely.css">
    <title>Ülőhely Kiválasztás</title>
</head>
<body>
    <h1>Ülőhely Kiválasztása</h1>

    <div class="seat-columns">
        <div class="seat-column" id="seatColumn1">
            <ul id="seatList1" ondrop="drop(event, 'seatList1')" ondragover="allowDrop(event)">
                <li class="draggable" draggable="true" ondragstart="drag(event)">Üres hely</li>
            </ul>
        </div>

        <div class="seat-column" id="seatColumn2">
            <ul id="seatList2" ondrop="drop(event, 'seatList2')" ondragover="allowDrop(event)">
                <li class="draggable" draggable="true" ondragstart="drag(event)">Üres hely</li>
            </ul>
        </div>
    </div>

    <button type="button" id="fileSelectButton" onclick="loadFile()">Fájl kiválasztása</button>
    <button type="button" onclick="resetAll()">Törlés</button>

    <div id="nameContainer"></div>

    <script>
        const seatCount = 20;
        const seats1 = new Array(seatCount / 2).fill("");
        const seats2 = new Array(seatCount / 2).fill("");

        let originalNameContainerContent = "";

        let fileSelected = false;

        function displaySeats() {
            const seatList1 = document.getElementById("seatList1");
            const seatList2 = document.getElementById("seatList2");
            seatList1.innerHTML = "";
            seatList2.innerHTML = "";

            for (let i = 0; i < seatCount / 2; i++) {
                createListItem(seatList1, seats1[i]);
                createListItem(seatList2, seats2[i]);
            }
        }

        function createListItem(seatList, name) {
            const listItem = document.createElement("li");
            listItem.className = "draggable";
            listItem.draggable = true;
            listItem.textContent = name !== "" ? name : "Üres hely";
            listItem.addEventListener("dragstart", drag);
            seatList.appendChild(listItem);
        }

        let dragSource = null;

        function drag(event) {
            dragSource = event.target;
            event.dataTransfer.setData("text", event.target.textContent);
        }

        function allowDrop(event) {
            event.preventDefault();
        }

        function drop(event, seatListId) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const seatList = document.getElementById(seatListId);
            const listItem = event.target;

            if (listItem.className === "draggable") {
                const sourceText = dragSource.textContent;
                dragSource.textContent = listItem.textContent;
                listItem.textContent = sourceText;

                const index1 = Array.from(document.getElementById("seatList1").children).indexOf(dragSource);
                const index2 = Array.from(document.getElementById("seatList2").children).indexOf(listItem);

                if (seatListId === "seatList1") {
                    seats1[index1] = listItem.textContent;
                    seats2[index2] = sourceText;
                } else if (seatListId === "seatList2") {
                    seats2[index2] = listItem.textContent;
                    seats1[index1] = sourceText;
                }
            }
        }

        displaySeats();

        function loadFile() {
            if (fileSelected) {
                alert("Új fájl kiválasztásához először törölje ki az eddigi fájlokat a Törlés gombbal!");
                return;
            }

            const fileInput = document.createElement("input");
            fileInput.type = "file";
            fileInput.accept = ".txt";

            fileInput.addEventListener("change", (event) => {
                fileSelected = true;
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const fileContent = e.target.result;
                        processFileContent(fileContent);
                    };
                    reader.readAsText(file);
                }
            });

            fileInput.click();
        }

        function processFileContent(content) {
            const names = content.split('\n');
            const container = document.getElementById("nameContainer");
            originalNameContainerContent = container.innerHTML;
            container.innerHTML = '';

            for (let i = 0; i < names.length && i < seatCount; i++) {
                const name = names[i].trim();

                if (name) {
                    const nameDiv = document.createElement("div");
                    nameDiv.textContent = name;
                    nameDiv.classList.add("name-entry");
                    nameDiv.draggable = true;
                    nameDiv.addEventListener("dragstart", drag);
                    container.appendChild(nameDiv);
                }
            }
            displaySeats();
        }

        function resetAll() {
            const container = document.getElementById("nameContainer");
            container.innerHTML = originalNameContainerContent;

            seats1.fill("");
            seats2.fill("");

            displaySeats();

            fileSelected = false;
            document.getElementById("fileSelectButton").disabled = false;
        }
    </script>
</body>
</html>
